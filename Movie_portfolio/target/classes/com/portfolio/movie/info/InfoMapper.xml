<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.portfolio.movie.info.InfoMapper">
	<insert id="setCrawl" parameterType="com.portfolio.movie.info.InfoVO">
		INSERT INTO movie_info(movieTitle,img,movieRate,openDate,movieAge)
		VALUES(#{movieTitle},#{img},#{movieRate},#{openDate},#{movieAge})
	</insert>
	<delete id="delCrawl">
		DELETE FROM movie_info
	</delete>
	
	<select id="listCrawl" resultType="com.portfolio.movie.info.InfoVO">
		SELECT * FROM movie_info;
	</select>
	
	<select id="selectMovie" resultType="com.portfolio.movie.info.InfoVO" parameterType="String">
		SELECT movieTitle, openDate, movieAge, img, movieRate,
			(SELECT AVG(star) FROM movie_cmt WHERE movieTitle=#{movieTitle}) star
		FROM movie_info
		WHERE movieTitle = #{movieTitle};
	</select>
	<insert id="insertCmt" parameterType="com.portfolio.movie.info.MovieCmtVO"
		useGeneratedKeys="true" keyProperty="i_comment">
		INSERT INTO movie_cmt(cid,star,ctnt,movieTitle,i_user) 
		VALUES(#{cid},#{star},#{ctnt},#{movieTitle},#{i_user})
	</insert>
	<select id="selectCmt" parameterType="String" resultType="com.portfolio.movie.info.MovieCmtVO">
		SELECT cid,star,ctnt 
		FROM movie_cmt 
		WHERE movieTitle=#{movieTitle}
	</select>
</mapper>